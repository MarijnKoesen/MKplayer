if(!window.MK)window.MK={};(function(MK){MK.ajax=function(url,options){var options=options||{},defaultOptions={async:true,method:'POST',decodeJson:true,callback:null};MK.extend(options,defaultOptions,false);var xmlHttp=new XMLHttpRequest();if(options.callback)xmlHttp.onreadystatechange=function(){if(xmlHttp.readyState==4)if(options.decodeJson){try{options.callback(eval(xmlHttp.responseText))}catch(e){console.error(e)}}else options.callback(xmlHttp)};xmlHttp.open(options.method,url,(options.async)?true:false);xmlHttp.send(null)};MK.extend=function(dest,source,overwrite){for(var attr in source)if(!dest.hasOwnProperty(attr)||overwrite)dest[attr]=source[attr]};MK.draggable=(function(){var hasRegisteredMouseMoveEvent=false,draggingElement,draggingOptions,dragStartMousePos,dragStartElementPos,that=this,registerMouseMoveEvent=function(){window.addEventListener('mousemove',function(event){if(this.draggingElement){if(this.draggingOptions.drag)if(this.draggingOptions.drag(event,this.draggingElement)===false)return;if(!this.dragStartMousePos){this.dragStartMousePos={x:event.clientX,y:event.clientY};this.dragStartElementPos={x:this.draggingElement.offsetLeft,y:this.draggingElement.offsetTop}};if(this.draggingOptions.dragX){var newX=this.dragStartElementPos.x+(parseInt(event.clientX)-this.dragStartMousePos.x);if(this.draggingOptions.constrainToParent)if(newX<0){newX=0}else{var maxX=(this.draggingElement.parentNode.offsetWidth||window.innerWidth)-this.draggingElement.offsetWidth;if(newX>maxX)newX=maxX};this.draggingElement.style.left=newX+"px"};if(this.draggingOptions.dragY){var newY=this.dragStartElementPos.y+(parseInt(event.clientY)-this.dragStartMousePos.y);if(this.draggingOptions.constrainToParent)if(newY<0){newY=0}else{var maxY=(this.draggingElement.parentNode.offsetHeight||window.innerHeight)-this.draggingElement.offsetHeight;if(newY>maxY)newY=maxY};this.draggingElement.style.top=newY+"px"};if(this.draggingOptions.drag)this.draggingOptions.drag(event,this.draggingElement)}},false);hasRegisteredMouseMoveEvent=true};window.addEventListener('mouseup',function(){this.draggingElement=null;this.dragStartMousePos=null;this.dragStartElementPos=null},false)
function setDraggingElement(element,options,event){var enableDragging=true;if(options.dragStart){if(options.dragStart(event,element)===false)enableDragging=false}else if(options.strict&&event.target!=element)enableDragging=false;if(enableDragging){this.draggingElement=element;this.draggingOptions=options}};return function(element,options){var options=options||{},defaults={constrainToParent:true,dragX:true,dragY:true,drag:null,dragStart:null,strict:true};MK.extend(options,defaults);if(!hasRegisteredMouseMoveEvent)registerMouseMoveEvent();element.addEventListener('mousedown',setDraggingElement.bind(that,element,options))}})();MK.getAbsolutePosition=function(element){var pos={x:0,y:0};do{if(element.offsetLeft)pos.x=pos.x+parseInt(element.offsetLeft);if(element.offsetTop)pos.y=pos.y+parseInt(element.offsetTop);element=element.parentNode}while(element);return pos};MK.timeToSeconds=function(time){var match,seconds;if((match=time.match(/^(([0-9])+:)?([0-9]+):([0-9]+)$/))){seconds=(parseInt(match[3])*60)+parseInt(match[4]);if(match[2])seconds+=parseInt(match[2])*60*60;return seconds}else if(typeof time=='number'||time.match(/^[0-9]+(\.[0-9]+)?$/)){return parseInt(time)}else return-1};MK.secondsToTime=function(theSeconds){if(typeof theSeconds=='number'||theSeconds.match(/^[0-9]+(\.[0-9]+)?$/)){var remainingSeconds=Math.round(theSeconds),hours,minutes,seconds=0;if(remainingSeconds>3600){hours=Math.floor(remainingSeconds/3600);remainingSeconds=remainingSeconds%3600};if(remainingSeconds>60)minutes=Math.floor(remainingSeconds/60);seconds=remainingSeconds%60;var theTime=(hours>0)?hours+":":'';theTime+=(minutes>0)?minutes+":":'0:';theTime+=(seconds<10)?"0"+seconds:seconds;return theTime}else if(typeof theSeconds=='string'&&theSeconds.match(/^(([0-9])+:)?([0-9]+):([0-9]+)$/)){return theSeconds}else return null}})(window.MK);if(!window.MK)window.MK={};(function(MK){MK.EventRegistry=function(){this.listeners={}};MK.extend(MK.EventRegistry.prototype,{broadcast:function(eventName,parameter){var i=0,listener;if(eventName in this.listeners)while((listener=this.listeners[eventName][i++]))listener(parameter)},addListener:function(eventName,callback){if(this.listeners[eventName]){this.listeners[eventName].push(callback)}else this.listeners[eventName]=[callback]},removeAllListeners:function(eventName){if(eventName in this.listeners)this.listeners[eventName]=[]},removeListener:function(eventName,callback){if(eventName in this.listeners)if(this.listeners[eventName].indexOf(callback)!=-1)this.listeners[eventName].splice(this.listeners[eventName].indexOf(callback),1)}})})(MK);(function(MK){MK.HtmlBuilder=function(){if(!MK.HtmlBuilderInstance&&this==MK)MK.HtmlBuilderInstance=new MK.HtmlBuilder();return MK.HtmlBuilderInstance};MK.extend(MK.HtmlBuilder.prototype,{build:function(obj){var i,node,nodes;if(obj.length){while((node=obj[i++]))nodes.push(this.buildNode(node));return nodes}else return this.buildNode(obj)},buildNode:function(node){var element=document.createElement(node.n),attribute;if('a'in node)for(attribute in node.a)element.setAttribute(attribute,node.a[attribute]);if('h'in node)element.innerHTML=node.h;if('t'in node)if(document.all){element.innerText=node.t}else element.textContent=node.t;if('c'in node)for(var i=0;i<node.c.length;i++)element.appendChild(this.buildNode(node.c[i]));if('e'in node)for(event in node.e)element[('on'+event)]=node.e[event];return element}})})(MK);(function(MK){MK.Player=function(options){this.EVENTS=['play','playing','stop','pause','songAdded','playlistLoaded','volumeChanged','songChanged','repeatStateChanged'];this.PLAYING_STATES={STOPPED:'STOPPED',PLAYING:'PLAYING',PAUSED:'PAUSED'};this.REPEAT_STATES={REPEAT_NONE:'REPEAT_NONE',REPEAT_ONE:'REPEAT_ONE',REPEAT_ALL:'REPEAT_ALL'};this.playlist=[];this.playlistLoadQueue=[];this.playQueue=[];this.currentSong=null;this.playingState=this.PLAYING_STATES.STOPPED;this.repeatState=this.REPEAT_STATES.REPEAT_ALL;this.shuffle=false;this.volume=1;this.eventRegistry=new MK.EventRegistry();this._init()};MK.extend(MK.Player.prototype,{addSongs:function(songs){var song,i=0;while((song=songs[i++]))this.addSong(song)},addSong:function(song){if(MK.Song.prototype.isSong(song)){this.playlist.push(song);this.eventRegistry.broadcast('songAdded',song);return this.playlist.length-1}else return false},play:function(playlistIndex){if(!this.playlist.length)return false;if(playlistIndex===undefined)playlistIndex=this.getCurrentSongIndex();var newSong=this.playlist[playlistIndex];if(newSong){if(this.currentSong!=newSong){this.audioEngine.src=newSong.url;this.eventRegistry.broadcast('songChanged',newSong)}else if(this.playingState!=this.PLAYING_STATES.PAUSED)this.audioEngine.currentTime=0;this.currentSong=newSong;this.playingState=this.PLAYING_STATES.PLAYING;this.audioEngine.play();this.eventRegistry.broadcast("play",this.currentSong)}},stop:function(){if(this.playingState==this.PLAYING_STATES.PLAYING){this.audioEngine.pause();if(this.audioEngine.currentTime)this.audioEngine.currentTime=0};this.playingState=this.PLAYING_STATES.STOPPED;this.eventRegistry.broadcast('stop',this.currentSong)},pause:function(){this.audioEngine.pause();this.playingState=this.PLAYING_STATES.PAUSED;this.eventRegistry.broadcast("pause")},next:function(){if(!this.playlist.length)return false;if(this.repeatState==this.REPEAT_STATES.REPEAT_ONE){this.play(this.getCurrentSongIndex())}else if(this.playQueue.length){var song=this.playQueue.shift(),songIndex;if((songIndex=this.playlist.indexOf(song))>=0){this.play(songIndex)}else this.next()}else if(this.shuffle){this.play(Math.round(Math.random()*this.playlist.length))}else{var nextSongIndex=this.getCurrentSongIndex()+1;if(this.playlist[nextSongIndex]){this.play(nextSongIndex)}else if(this.repeatState==this.REPEAT_STATES.REPEAT_ALL)this.play(0)}},previous:function(){if(!this.playlist.length)return false;if(this.repeatState==this.REPEAT_STATES.REPEAT_ONE){this.play(this.getCurrentSongIndex())}else if(this.playQueue.length){var song=this.playQueue.shift(),songIndex;if((songIndex=this.playlist.indexOf(song))>=0){this.play(songIndex)}else this.previous()}else if(this.shuffle){this.play(Math.round(Math.random()*this.playlist.length))}else{var previousSongIndex=this.getCurrentSongIndex()-1;if(this.playlist[previousSongIndex]){this.play(previousSongIndex)}else if(this.repeatState==this.REPEAT_STATES.REPEAT_ALL)this.play(this.playlist.length-1)}},setVolume:function(value){value=parseFloat(value);if(value===NaN)value=1;if(value<0){value=0}else if(value>1)value=1;this.volume=value;this.audioEngine.volume=this.volume;this.eventRegistry.broadcast('volumeChanged',this.volume)},seek:function(time){if(time>=0){this.audioEngine.currentTime=time}else this.audioEngine.currentTime=0},getCurrentSongIndex:function(){var currentSongIndex=this.playlist.indexOf(this.currentSong);if(currentSongIndex>=0){return currentSongIndex}else return 0},appendPlaylist:function(url){MK.ajax(url,{callback:this._doAppendPlaylist.bind(this)})},loadPlaylist:function(url){this.playlist=[];this.appendPlaylist(url)},setRepeatState:function(repeatState){if(repeatState in this.REPEAT_STATES){this.repeatState=repeatState;this.eventRegistry.broadcast('repeatStateChanged',this.repeatState)}},addEventListener:function(event,listener){if(this.EVENTS.indexOf(event)>-1){this.eventRegistry.addListener(event,listener)}else console.log("Can't add an event listener to the unknown event: "+event)},_init:function(){this.audioEngine=document.createElement('audio');this.audioEngine.volume=this.volume;this.audioEngine.addEventListener('ended',this._onSongEnded.bind(this));this._broadcastPlayingEvent()},_broadcastPlayingEvent:function(){if(this.playingState==this.PLAYING_STATES.PLAYING)this.eventRegistry.broadcast('playing',{song:this.currentSong,currentTime:this.audioEngine.currentTime});setTimeout(this._broadcastPlayingEvent.bind(this),250)},_doAppendPlaylist:function(songs){var i=0,song;while((song=songs[i++]))this.playlistLoadQueue.push(song);this._loadSongsFromQueue()},_loadSongsFromQueue:function(){if(this.playlistLoadQueue.length){var doNow=this.playlistLoadQueue.splice(0,1e4),songs=[],i=0,song;while((song=doNow[i++]))if(MK.timeToSeconds(song.length)>0)songs.push(new MK.Song(song));this.addSongs(songs)};if(this.playlistLoadQueue.length){setTimeout(this._loadSongsFromQueue.bind(this),100)}else this.eventRegistry.broadcast('playlistLoaded')},_onSongEnded:function(){this.playingState=this.PLAYING_STATES.STOPPED;this.next()}})})(MK);(function(MK){MK.Song=function(attributes){this.url=null;this.title=null;this.artist=null;this.album=null;this.length=null;if(typeof attributes=='object'){MK.extend(this,attributes,true)}else{console.error("The attributes parameter to create a Song needs to be an object");return null};if(!this.url){console.error("A song always needs to have a url");return null};this.length=MK.timeToSeconds(this.length)};MK.extend(MK.Song.prototype,{isSong:function(obj){return typeof obj=='object'&&obj.constructor.prototype==MK.Song.prototype},getFullName:function(){var fullName='';if(this.artist)fullName+=this.artist+" - ";if(this.album)fullName+=this.album+" - ";if(this.title)fullName+=this.title;return fullName.replace(/ - $/,"")},getLength:function(){return this.length}})})(MK);(function(MK){MK.BaseSkin=function(player){this.player=player;this.mainWindow=null;this.mainWindowArtistLabel=null;this.mainWindowTitleLabel=null;this.mainWindowAlbumLabel=null;this.playlistWindow=null;this.playlistWindowContent=null;this.playlistWindow=null;this.playButton=null;this.repeatButton=null;this.shuffleButton=null;this.seeker=null;this.volumeSlider=null;this.currentTimeLabel=null;this.totalTimeLabel=null};MK.extend(MK.BaseSkin.prototype,{init:function(){this.createWindows();this.initializeElements();this._disableElementSelection();this.registerEvents();this.redrawPlaylist()},createWindows:function(){this.mainWindow=this.createMainWindow();document.body.appendChild(this.mainWindow);this.playlistWindow=this.createPlaylistWindow();document.body.appendChild(this.playlistWindow)},initializeElements:function(){this.mainWindowArtistLabel=this.mainWindow.getElementsByClassName('artist')[0];this.mainWindowTitleLabel=this.mainWindow.getElementsByClassName('title')[0];this.mainWindowAlbumLabel=this.mainWindow.getElementsByClassName('album')[0];this.playButton=this.mainWindow.getElementsByClassName('play')[0];this.repeatButton=this.mainWindow.getElementsByClassName('repeat')[0];this.shuffleButton=this.mainWindow.getElementsByClassName('shuffle')[0];this.seeker=this.mainWindow.getElementsByClassName('seek')[0];this.volumeSlider=this.mainWindow.getElementsByClassName('volumeSlider')[0];this.currentTimeLabel=this.mainWindow.getElementsByClassName('currentTime')[0];this.totalTimeLabel=this.mainWindow.getElementsByClassName('totalTime')[0];this.playlistWindowContent=this.playlistWindow.getElementsByTagName('table')[0];this.volumeSlider.value=this.player.volume;this.styleRepeatButton();this.styleShuffleButton()},createMainWindow:function(){return MK.HtmlBuilder().build({n:'div',a:{class:'window main'},c:[{n:'div',a:{class:"header"},c:[{n:'div',a:{class:"minimize"}}]},{n:'div',a:{class:"body-left"}},{n:'div',a:{class:"body-content"},c:[{n:'div',a:{class:"label"},t:"Title"},{n:'div',a:{class:"title"},t:String.fromCharCode(160)},{n:'div',a:{class:"label"},t:"Artist"},{n:'div',a:{class:"artist"},t:String.fromCharCode(160)},{n:'div',a:{class:"label"},t:"Album"},{n:'div',a:{class:"album"},t:String.fromCharCode(160)},{n:'div',a:{class:"progress"},c:[{n:'div',a:{class:"currentTime"},t:"0:00"},{n:'input',a:{type:"range",value:0,min:0,max:100,step:0.1,class:"seek"},e:{change:this.seek.bind(this)}},{n:'div',a:{class:"totalTime"},t:"0:00"}]},{n:'input',a:{type:"range",value:1,min:0,max:1,step:0.05,class:"volumeSlider"},e:{change:this.changeVolume.bind(this)}},{n:'div',a:{class:"controls"},c:[{n:'div',a:{class:"button previous"},t:"Previous",e:{click:this.clickPrevious.bind(this)}},{n:'div',a:{class:"button play"},t:"Play",e:{click:this.clickPlay.bind(this)}},{n:'div',a:{class:"button pause"},t:"Pause",e:{click:this.player.pause.bind(this.player)}},{n:'div',a:{class:"button stop"},t:"Stop",e:{click:this.player.stop.bind(this.player)}},{n:'div',a:{class:"button next"},t:"Next",e:{click:this.clickNext.bind(this)}},{n:'div',a:{class:"button repeat"},t:"Repeat",e:{click:this.clickRepeat.bind(this)}},{n:'div',a:{class:"button shuffle"},t:"Shuffle",e:{click:this.clickShuffle.bind(this)}}]}]},{n:'div',a:{class:"body-right"}},{n:'div',a:{class:"footer"}}]})},createPlaylistWindow:function(){return MK.HtmlBuilder().build({n:'div',a:{class:'window playlist'},c:[{n:'div',a:{class:"header",c:[{n:'div',a:{class:"minimize"}}]}},{n:'div',a:{class:"body-left"}},{n:'div',a:{class:"body-content"},e:{click:this.clickSong.bind(this)},c:[{n:'table',a:{cellSpacing:0}}]},{n:'div',a:{class:"body-right"}},{n:'div',a:{class:"footer"}}]})},createSongRow:function(song,rowNumber){return MK.HtmlBuilder().build({n:'tr',a:{row:rowNumber-1},c:[{n:'td',a:{class:'r'},t:rowNumber+"."},{n:'td',a:{class:'n'},t:song.getFullName()},{n:'td',a:{class:'d'},t:MK.secondsToTime(song.getLength())}]})},registerEvents:function(){this.player.addEventListener('play',this.playerOnPlay.bind(this));this.player.addEventListener('stop',this.playerOnStop.bind(this));this.player.addEventListener('playing',this.playerOnPlaying.bind(this));this.player.addEventListener('playlistLoaded',this.playerOnPlaylistLoaded.bind(this));this.player.addEventListener('volumeChanged',this.playerOnVolumeChanged.bind(this));this.player.addEventListener('songChanged',this.playerOnSongChanged.bind(this))},playerOnSongChanged:function(song){this.mainWindowArtistLabel.innerHTML=song.artist||"&nbsp;";this.mainWindowAlbumLabel.innerHTML=song.album||"&nbsp;";this.mainWindowTitleLabel.innerHTML=song.title||"&nbsp;";this.seeker.max=song.getLength();this.seeker.value=0;this.totalTimeLabel.innerHTML=MK.secondsToTime(song.length);this.stylePlayButton()},playerOnPlay:function(song){this.selectRow(this.player.playlist.indexOf(song));this.stylePlayButton()},playerOnStop:function(){this.seeker.value=0;this.currentTimeLabel.innerHTML='0:00';this.stylePlayButton()},playerOnPlaying:function(param){this.seeker.value=param.currentTime;this.currentTimeLabel.innerHTML=MK.secondsToTime(param.currentTime)},playerOnPlaylistLoaded:function(){this.redrawPlaylist()},playerOnVolumeChanged:function(newVolume){this.volumeSlider.value=newVolume},redrawPlaylist:function(){this.playlistWindowContent.innerHTML='';var table=MK.HtmlBuilder().build({n:'table',a:{cellSpacing:0}}),i=0,song;while((song=this.player.playlist[i++]))table.appendChild(this.createSongRow(song,i));if(this.playlistWindowContent.parentNode)this.playlistWindowContent.parentNode.removeChild(this.playlistWindowContent);this.playlistWindow.getElementsByClassName('body-content')[0].appendChild(table);this.playlistWindowContent=table},selectRow:function(rowNumber,row){if(!row)row=this.playlistWindowContent.childNodes[rowNumber];if(this.currentPlayingTableRow)this.currentPlayingTableRow.className=this.currentPlayingTableRow.className.replace(/\s*currentlyPlaying/,"");row.className=(row.className+" currentlyPlaying").trim();this.currentPlayingTableRow=row},clickSong:function(event){var tableRow=event.target;while(tableRow&&tableRow.nodeName!='TR')tableRow=tableRow.parentElement;this.seeker.value=0;this.selectRow(tableRow.getAttribute('row'),tableRow);this.player.play(tableRow.getAttribute('row'));return false},clickPlay:function(){this.player.play();this.stylePlayButton()},clickRepeat:function(event){if(this.player.repeatState==this.player.REPEAT_STATES.REPEAT_NONE){this.player.setRepeatState(this.player.REPEAT_STATES.REPEAT_ALL)}else if(this.player.repeatState==this.player.REPEAT_STATES.REPEAT_ALL){this.player.setRepeatState(this.player.REPEAT_STATES.REPEAT_ONE)}else this.player.setRepeatState(this.player.REPEAT_STATES.REPEAT_NONE);this.styleRepeatButton()},clickShuffle:function(event){this.player.shuffle=!this.player.shuffle;this.styleShuffleButton()},clickNext:function(){this.seeker.value=0;this.player.next();this.ensureCurrentSongIsVisible()},clickPrevious:function(){this.seeker.value=0;this.player.previous();this.ensureCurrentSongIsVisible()},clickSeekBackward:function(){this.player.seek(this.player.audioEngine.currentTime-5)},clickSeekForward:function(){this.player.seek(this.player.audioEngine.currentTime+5)},seek:function(event){this.player.seek(event.target.value)},changeVolume:function(event){this.player.setVolume(event.target.value)},ensureCurrentSongIsVisible:function(){var currentScroll=parseInt(this.playlistWindowContent.parentNode.scrollTop),viewPortHeight=this.playlistWindowContent.parentNode.offsetHeight,songY=this.currentPlayingTableRow.offsetTop;if(songY<currentScroll+40){this.playlistWindowContent.parentNode.scrollTop=songY-50}else if(songY>currentScroll+viewPortHeight-50)this.playlistWindowContent.parentNode.scrollTop=songY-viewPortHeight+60},styleRepeatButton:function(){if(this.player.repeatState==this.player.REPEAT_STATES.REPEAT_ALL){this.repeatButton.innerHTML="Repeat: all"}else if(this.player.repeatState==this.player.REPEAT_STATES.REPEAT_NONE){this.repeatButton.innerHTML="Repeat: none"}else if(this.player.repeatState==this.player.REPEAT_STATES.REPEAT_ONE)this.repeatButton.innerHTML="Repeat: one"},styleShuffleButton:function(){if(this.player.shuffle){this.shuffleButton.innerHTML="Shuffle: on"}else this.shuffleButton.innerHTML="Shuffle: off"},stylePlayButton:function(){},_disableElementSelection:function(){document.onselectstart=function(){return false}}})})(MK);(function(MK){MK.FancySkin=function(player){this.player=player;this.scroller=null};MK.FancySkin.prototype=new MK.BaseSkin();MK.extend(MK.FancySkin.prototype,{initializeElements:function(){MK.BaseSkin.prototype.initializeElements.call(this);this._initializeScrollbar();this._makeResizable()},_initializeScrollbar:function(){this.scroller=this.playlistWindow.getElementsByClassName('scroller')[0];MK.draggable(this.scroller,{dragX:false,drag:this.handleScrollerDrag.bind(this)});MK.draggable(this.playlistWindow,{strict:false,dragStart:this.handlePlaylistWindowMoveStart.bind(this)});MK.draggable(this.mainWindow,{strict:true});this.playlistWindowContent.parentNode.addEventListener('scroll',this.handlePlaylistWindowScroll.bind(this))},_makeResizable:function(){MK.draggable(this.playlistWindow.getElementsByClassName('footer-right')[0],{drag:this.handlePlaylistResize.bind(this)});MK.draggable(this.playlistWindow.getElementsByClassName('body-right')[0],{drag:this.handlePlaylistResize.bind(this)});MK.draggable(this.playlistWindow.getElementsByClassName('footer-stretch')[0],{drag:this.handlePlaylistResize.bind(this)})},createMainWindow:function(){return MK.HtmlBuilder().build({n:'div',a:{class:'window main'},c:[{n:'div',a:{class:"header"},c:[{n:'div',a:{class:"minimize"}}]},{n:'div',a:{class:"body-left"}},{n:'div',a:{class:"body-content"},c:[{n:'div',a:{class:"title"},h:"&nbsp;"},{n:'div',a:{class:"artist"},h:"&nbsp;"},{n:'div',a:{class:"album"},h:"&nbsp;"},{n:'div',a:{class:"progress"},c:[{n:'div',a:{class:"currentTime"},t:"0:00"},{n:'input',a:{type:"range",value:0,min:0,max:100,step:0.1,class:"seek"},e:{change:this.seek.bind(this)}},{n:'div',a:{class:"totalTime"},t:"0:00"}]},{n:'div',a:{class:"controls"},c:[{n:'div',a:{class:"button previous"},e:{click:this.clickPrevious.bind(this)}},{n:'div',a:{class:"button seek-backward"},e:{mousedown:this.clickSeekBackward.bind(this)}},{n:'div',a:{class:"button play"},e:{click:this.clickPlay.bind(this)}},{n:'div',a:{class:"button seek-forward"},e:{mousedown:this.clickSeekForward.bind(this)}},{n:'div',a:{class:"button next"},e:{click:this.clickNext.bind(this)}},{n:'div',a:{class:"button volume"},c:[{n:'input',a:{type:"range",value:1,min:0,max:1,step:0.05,class:"volumeSlider"},e:{change:this.changeVolume.bind(this)}}]},{n:'div',a:{class:"button repeat"},e:{click:this.clickRepeat.bind(this)}},{n:'div',a:{class:"button shuffle"},e:{click:this.clickShuffle.bind(this)}}]}]},{n:'div',a:{class:"body-right"}},{n:'div',a:{class:"footer"}}]})},createPlaylistWindow:function(){return MK.HtmlBuilder().build({n:'div',a:{class:'window playlist'},c:[{n:'div',a:{class:"header"},c:[{n:'div',a:{class:"header-stretch"}},{n:'div',a:{class:"header-left"}},{n:'div',a:{class:"header-right"}}]},{n:'div',a:{class:"body"},c:[{n:'div',a:{class:"body-left"}},{n:'div',a:{class:"body-content"},e:{click:this.clickSong.bind(this)},c:[{n:'table',a:{cellSpacing:0}}]},{n:'div',a:{class:"body-right"},c:[{n:'div',a:{class:"scroller"}}]}]},{n:'div',a:{class:"footer"},c:[{n:'div',a:{class:"footer-stretch"}},{n:'div',a:{class:"footer-left"}},{n:'div',a:{class:"footer-right"}}]}]})},stylePlayButton:function(){if(this.player.playingState==this.player.PLAYING_STATES.PLAYING){this.playButton.className=this.playButton.className.replace(" play"," pause")}else this.playButton.className=this.playButton.className.replace(" pause"," play")},styleRepeatButton:function(){if(this.player.repeatState==this.player.REPEAT_STATES.REPEAT_ALL){this.repeatButton.className="button repeat all"}else if(this.player.repeatState==this.player.REPEAT_STATES.REPEAT_ONE){this.repeatButton.className="button repeat one"}else this.repeatButton.className="button repeat none"},styleShuffleButton:function(){if(this.player.shuffle){this.shuffleButton.className="button shuffle on"}else this.shuffleButton.className="button shuffle off"},clickPlay:function(){if(this.player.playingState==player.PLAYING_STATES.PLAYING){this.player.pause()}else this.player.play();this.stylePlayButton()},redrawPlaylist:function(){MK.BaseSkin.prototype.redrawPlaylist.call(this);this.handlePlaylistWindowScroll()},handleScrollerDrag:function(){var scrollPercentage=this.scroller.offsetTop/(this.scroller.parentNode.offsetHeight-this.scroller.offsetHeight),maxScroll=this.playlistWindowContent.offsetHeight;this.playlistWindowContent.parentNode.scrollTop=maxScroll*scrollPercentage},handlePlaylistWindowScroll:function(){var scrollPercentage=this.playlistWindowContent.parentNode.scrollTop/(this.playlistWindowContent.offsetHeight-this.playlistWindowContent.parentNode.offsetHeight),maxScrollerPos=this.scroller.parentNode.offsetHeight-this.scroller.offsetHeight;this.scroller.style.top=Math.round(maxScrollerPos*scrollPercentage)+"px"},handlePlaylistWindowMoveStart:function(event){var allowedElements=['body-left','header-left','header-stretch'];for(var i=0;i<allowedElements.length;i++){var element=this.playlistWindow.getElementsByClassName(allowedElements[i])[0],elementPos=MK.getAbsolutePosition(element),xOk=(event.clientX>elementPos.x)&&event.clientX<(elementPos.x+element.offsetWidth),yOk=event.clientY>elementPos.y&&event.clientY<(elementPos.y+element.offsetHeight);if(xOk&&yOk)return true};return false},handlePlaylistResize:function(event,element){var topLeftCorner=MK.getAbsolutePosition(this.playlistWindow),mousePos={x:event.clientX,y:event.clientY};if(!element.className.match(/footer-stretch/)){var newWidth=mousePos.x-topLeftCorner.x;if(newWidth>200)this.playlistWindow.style.width=newWidth+"px"};if(!element.className.match(/body-right/)){var newHeight=mousePos.y-topLeftCorner.y;if(newHeight>100)this.playlistWindow.style.height=newHeight+"px";this.handlePlaylistWindowScroll()};return false},seek:function(event){this.player.seek(event.target.value)}})})(MK)